x14.07-synack-cloud
===================

Файлы для статьи "Частичная облачность"

**response.php**
предоставляет данные о текущей нагрузке, находится на наблюдаемой машине (машинах)

**watcher.php**

управляет виртуалками - проверяет нагрузку, и при необходимости поднимает новую,
при этом добавляет запись о ней в балансирующий nginx.

**nginx.php**

находится на балансировшике запросов, обнавляет список бэкендов по запросу,
в подакшене должен требовать авторизацию (например средствами nginx или путем расширения).
Для работы необходимо наличие файла конфигурации nginx backend.conf с доступом на запись для пользователя php.
Также необходимо sudo, с разрешением для php пользователяч запускать nginx(например /usr/sbin/nginx) без запроса пароля.

## Предупреждение

При размещение ноды на одном сервере с балансировщиком, необходимо обеспечнить отсутствие
проксирования запросов к nginx.php и response.php к бэкендам, например через явное укозание локейшенов:

    location =/nginx.php {
        root /var/www/default;
        fastcgi_pass php-www;
        include fastcgi_params;
        fastcgi_param   SCRIPT_FILENAME /var/www/default/nginx.php;
    }
    location =/response.php {
        root /var/www/default;
        include fastcgi_params;
        fastcgi_param   SCRIPT_FILENAME /var/www/default/response.php;
        fastcgi_pass php-www;

    }

## Расширение

При доработке скрипт может мониторить не только указанную виртуалку, но и вновь создаваемые,
для лучшего перераспределения нагрузки, а также отключать их при снижении.
